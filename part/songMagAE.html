<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>李扬故事汇后台管理系统</title>
		<meta name="keywords" content="">
		<meta name="description" content="">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<link rel="shortcut icon" href="../img/icon.png" type="image/x-icon" />
		<link rel="stylesheet" href="../css/reset.css" />
		<link rel="stylesheet" href="../css/comment.css" />
	</head>

	<body>
		<div class="main_mask">
			<div class="con">
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">曲目名称</span>：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="Name" class="required bigtextlength" />
						<div class="masklist_prompt">不超过30个字</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">是否精品</span>：</div>
					<div class="masklistvalue">
						<select name="" id="isPre" class="required smallip">
							<option value="">是否精品</option>
							<option value="1">是</option>
							<option value="0">否</option>
						</select>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname">原作者：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="Author" />
						<div class="masklist_prompt">曲目原作者名称</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">艺术家</span>：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="Artist" class="required" />
						<div class="masklist_prompt">曲目播录者名称</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">价格</span>：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="Price" class="required smallip" />
						<div class="masklist_prompt">免费曲目请填"0"</div>
					</div>
				</div>
				<!--<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">曲目分类</span>：</div>
					<div class="masklistvalue">
						<select name="" id="Category" class="required smallip">
							<option value="">请选择分类</option>
						</select>
					</div>
				</div>-->
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">所属专辑</span>：</div>
					<div class="masklistvalue">
						<select name="" id="Album" class="required smallip">
							<option value="">请选择专辑</option>
						</select>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">曲目排序</span>：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="melodySort" class="required smallip" />
						<div class="masklist_prompt">越小越靠前</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">年龄阶段</span>：</div>
					<div class="masklistvalue">
						<select name="" id="ages" class="required smallip">
							<option value="">请选择年龄</option>
							<option value="0-3">0-3岁</option>
							<option value="3-5">3-5岁</option>
							<option value="5-7">5-7岁</option>
							<option value="7-20">7岁以上</option>
						</select>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">曲目标签</span>：</div>
					<div class="masklistvalue">
						<input type="text" name="" value="" id="Tags" class="required" />
						<div class="masklist_prompt">最多10个标签,多个标签请用","隔开</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">曲目封面</span>：</div>
					<div class="masklistvalue">
						<img src="" alt="" id="showImage" onerror="this.src='../img/noimg.png'" class="requiredimg" />
						<div class="masklist_prompt">仅支持jpg、png、或gif格式</div>
						<div class="btn upLoadImg" onclick="uploadimg(this);">本地上传</div>
					</div>
				</div>
				<div class="masklist">
					<div class="masklistname"><span>*</span><span class="text">上传曲目</span>：</div>
					<div class="masklistvalue">
						<audio controls="controls" src="" id="showsong" class="requiredimg"></audio>
						<div class="btn margintop8" onclick="uploadsong();" id="creatsong">本地上传</div>
					</div>
				</div>
				<form method="post" action="" enctype="multipart/form-data" id="coverImage" style="display: none;">
					<input type="text" name="fileName" id="Imagetext" value="" />
					<input type="file" name="file" id="ImageFile" value="" onchange="subimtimgBtn();" />
				</form>
				<form method="post" action="" enctype="multipart/form-data" id="coversong" style="display: none;">
					<input type="file" name="file" id="songFile" value="" onchange="subimtsongBtn();" />
					<input type="text" name="fileName" id="songtext" value="" onchange="subimtsongBtn();" />
				</form>
				<div class="maskbtnbox">
					<div class="btn" onclick="resetmask();">重填</div>
					<div class="btn" onclick="save();" id="creatsave">确定</div>
				</div>
				<div class="maskbtnbox" id="QRCodebox">
					<div id="QRCode"></div>
					<div>
						<a id="download" download=""></a>
						<div class="maskbtnbox" style="width: 100%;">
							<div class="btn margintop8" onclick="downerweima();">下载二维码</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../js/jquery-1.9.1.min.js"></script>
	<script src="../js/photoload.js"></script>
	<script src="../js/photoloadinit.js"></script>
	<script src="../js/uploadimg.js"></script>
	<script src="../layui/layui.all.js"></script>
	<script src="../js/vue.min.js"></script>
	<script src="../js/jquery.qrcode.js"></script>
	<script src="../js/utf.js"></script>
	<script src="../js/jquery.form.js"></script>
	<script src="../js/comment.js"></script>
	<script>
		function downerweima() {
			var canvas = $('#QRCode').find("canvas").get(0);
			var saveurl = canvas.toDataURL('image/png');
			$("#download").attr("download", $("#Name").val());
			$("#download").attr('href', saveurl).get(0).click();
			return false;
		}
		//		新建song
		function save() {
			var checkI = checkInput();
			if(checkI == true) {
				var paras = {
					melodyName: $("#Name").val(),
					melodyAuthor: $("#Author").val(),
					melodyCategory: $("#Category").val(),
					melodyArtist: $("#Artist").val(),
					melodyAlbum: $("#Album").val(),
					melodyTags: $("#Tags").val(),
					melodySort: $("#melodySort").val(),
					melodyAgeStart: $("#ages").val().split("-")[0],
					melodyAgeEnd: $("#ages").val().split("-")[1],
					melodyPrice: $("#Price").val(),
					melodyCoverImage: $("#showImage").attr("alt"),
					melodyFilePath: $("#songtext").val(),
					melodyPrecious: parseInt($("#isPre").val())
				};
				paras = JSON.stringify(paras);
				$.ajax({
					type: 'POST',
					url: url + 'melody/add.do',
					contentType: "application/json;charset=UTF-8",
					data: paras,
					dataType: 'json',
					success: function(data) {
						if(data.state == true) {
							layer.alert('新建成功', function() {
								parent.layer.close(index);
								window.parent.loaddata();
							});
						} else {
							layer.msg('新建失败');
						}
					}
				});
			}
		}
		//		修改数据
		function updata() {
			var checkI = checkInput();
			if(checkI == true) {
				var paras = {
					id: $(".main_mask").attr("data-id"),
					melodyName: $("#Name").val(),
					melodyAuthor: $("#Author").val(),
					melodyCategory: $("#Category").val(),
					melodyArtist: $("#Artist").val(),
					melodyAlbum: $("#Album").val(),
					melodyTags: $("#Tags").val(),
					melodySort: $("#melodySort").val(),
					melodyAgeStart: $("#ages").val().split("-")[0],
					melodyAgeEnd: $("#ages").val().split("-")[1],
					melodyPrice: $("#Price").val(),
					melodyCoverImage: $("#showImage").attr("alt"),
					melodyFilePath: $("#songtext").val(),
					melodyPrecious: parseInt($("#isPre").val())
				};
				paras = JSON.stringify(paras);
				$.ajax({
					type: 'POST',
					url: url + 'melody/update.do',
					contentType: "application/json;charset=UTF-8",
					data: paras,
					dataType: 'json',
					success: function(data) {
						if(data.state == true) {
							layer.alert('修改成功', function() {
								parent.layer.close(index);
								window.parent.loaddata();
							});
						} else {
							layer.msg('修改失败');
						}
					}
				});
			}
		}
		//加载分类和专辑
		function loadselect(okcallback) {
			var paras = {
				page: page
			};
			paras = JSON.stringify(paras);
			$.ajax({
				type: 'POST',
				url: url + 'melody/queryList.do',
				contentType: "application/json;charset=UTF-8",
				data: paras,
				dataType: 'json',
				success: function(data) {
					//					var songclassify = "";
					var albumclassify = "";
					//					for(var i = 0; i < data.data.categoryList.length; i++) {
					//						songclassify += "<option value='" + data.data.categoryList[i] + "'>" + data.data.categoryList[i] + "</option>";
					//					}
					//					$("#Category").append(songclassify);
					for(var i = 0; i < data.data.albumList.length; i++) {
						albumclassify += "<option value='" + data.data.albumList[i].id + "'>" + data.data.albumList[i].albumName + "</option>";
					}
					$("#Album").append(albumclassify);
					okcallback();
				}
			});
		}
	</script>

</html>